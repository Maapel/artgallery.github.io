<!Doctype: HTML w/ Processing>

<html>

  <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title>Processing Demo</title>
      <script type="text/javascript" src="js/processing.js"></script>
    <script src ="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.3/p5.min.js"></script>
    <script src ="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.3/addons/p5.dom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.7.3/addons/p5.sound.min.js"></script>
  </head>
  
  <body>
    <h1>PUT YOUR TITLE HERE</h1>
    <p>ADD DESCRIPTION HERE</p>
    
    <script type="application/processing">
    
ArrayList<PVector> enemyPoints;
PVector playerPoint;
boolean playerButtonPressed = false;
boolean startPauseButtonPressed = false;
boolean simulationRunning = false;  // Variable to keep track of simulation state

// Speeds for player and enemies
float v1 = 10;  // Player speed
float v2 = 2;  // Enemy speed

void setup() {
  size(800, 600);
  enemyPoints = new ArrayList<PVector>();
  playerPoint = null;  // No player point initially
  createButtons();
}

void draw() {
  background(255);

  if (simulationRunning) {
    // Player follows cursor
    if (playerPoint != null) {
      PVector direction = new PVector(mouseX, mouseY).sub(playerPoint);
      direction.setMag(v1);
      playerPoint.add(direction);
    }

    // Move enemies toward player if in their Voronoi region
    for (PVector enemy : enemyPoints) {
      float minDist = Float.MAX_VALUE;
      int closestPointIndex = -1;

      // Find the nearest enemy point to the player
      for (int i = 0; i < enemyPoints.size(); i++) {
        float dist = dist(playerPoint.x, playerPoint.y, enemyPoints.get(i).x, enemyPoints.get(i).y);
        if (dist < minDist) {
          minDist = dist;
          closestPointIndex = i;
        }
      }

      // If this enemy is the closest to the player, chase the player
      if (closestPointIndex != -1) {
        PVector dir = new PVector(playerPoint.x, playerPoint.y).sub(enemyPoints.get(closestPointIndex));
        dir.setMag(v2);
        enemyPoints.get(closestPointIndex).add(dir);
      }
    }
  }

  // Draw Voronoi diagram
  loadPixels();
  for (int x = 0; x < width; x++) {
    for (int y = 0; y < height; y++) {
      float minDist = Float.MAX_VALUE;
      int closestPointIndex = -1;

      // Find the nearest enemy point to (x, y)
      for (int i = 0; i < enemyPoints.size(); i++) {
        float dist = dist(x, y, enemyPoints.get(i).x, enemyPoints.get(i).y);
        if (dist < minDist) {
          minDist = dist;
          closestPointIndex = i;
        }
      }

      // Color the pixel based on the closest enemy point
      if (closestPointIndex != -1) {
        color col = color(50 + closestPointIndex * 30, 100 + closestPointIndex * 20, 150 + closestPointIndex * 10);
        pixels[x + y * width] = col;
      }
    }
  }
  updatePixels();

  // Draw enemy points
  fill(0);
  noStroke();
  for (PVector point : enemyPoints) {
    ellipse(point.x, point.y, 10, 10);
  }

  // Draw the player point (if it exists)
  if (playerPoint != null) {
    fill(255, 0, 0);  // Red color for the player
    ellipse(playerPoint.x, playerPoint.y, 15, 15);
  }

  // Draw buttons
  fill(200);
  rect(width - 150, height - 50, 130, 30);  // Player Button
  rect(width - 150, height - 100, 130, 30);  // Start/Pause Button

  fill(0);
  textAlign(CENTER, CENTER);
  text("Player Button", width - 85, height - 35);
  if (simulationRunning) {
    text("Pause Simulation", width - 85, height - 85);
  } else {
    text("Start Simulation", width - 85, height - 85);
  }
}

void mousePressed() {
  // Check if the mouse is inside the "Player Button"
  if (mouseX >= width - 150 && mouseX <= width - 20 && mouseY >= height - 50 && mouseY <= height - 20) {
    playerButtonPressed = true;
  } 
  // Check if the mouse is inside the "Start/Pause Button"
  else if (mouseX >= width - 150 && mouseX <= width - 20 && mouseY >= height - 100 && mouseY <= height - 70) {
    startPauseButtonPressed = true;
  }
  else if (playerButtonPressed) {
    // Add a player point at the mouse position
    playerPoint = new PVector(mouseX, mouseY);
    playerButtonPressed = false;
  } else if (startPauseButtonPressed) {
    // Toggle start/pause when the start/pause button is clicked
    simulationRunning = !simulationRunning;  // Toggle the simulation state
    startPauseButtonPressed = false;
  } else if (mouseButton == RIGHT) {
    // Right-click: remove an enemy point if clicked near it
    for (int i = 0; i < enemyPoints.size(); i++) {
      PVector enemy = enemyPoints.get(i);
      if (dist(mouseX, mouseY, enemy.x, enemy.y) < 15) { // Threshold of 15 for clicking near enemy
        enemyPoints.remove(i);
        break;  // Stop after removing one enemy point
      }
    }
  } else {
    // Add an enemy point at the mouse position (left click)
    enemyPoints.add(new PVector(mouseX, mouseY));
  }
}

void createButtons() {
  // Create the "Player Button" in the bottom right corner
  fill(200);
  rect(width - 150, height - 50, 130, 30);
  fill(0);
  textAlign(CENTER, CENTER);
  text("Player Button", width - 85, height - 35);

  // Create the "Start/Pause Simulation" button
  fill(200);
  rect(width - 150, height - 100, 130, 30);
  fill(0);
  textAlign(CENTER, CENTER);
  if (simulationRunning) {
    text("Pause Simulation", width - 85, height - 85);
  } else {
    text("Start Simulation", width - 85, height - 85);
  }
}


    </script>
    <canvas id="sketch" style="border: 1px solid black;"></canvas>
    
  </body>
  
</html>
